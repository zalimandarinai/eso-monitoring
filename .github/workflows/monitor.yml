name: ESO Monitoring (Python)

on:
  workflow_dispatch:
    inputs:
      ESO_ID:
        description: 'ESO objektas (pvz. 7117366)'
        required: true

jobs:
  check-eso:
    runs-on: ubuntu-latest
    env:
      # Persiunčiame į skriptą
      ESO_ID:             ${{ github.event.inputs.ESO_ID }}
      TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
      TELEGRAM_CHAT_ID:   ${{ secrets.TELEGRAM_CHAT_ID }}
      # Naudojame tą patį URL diagnostikai
      URL: >
        https://www.eso.lt/web/namams/gaminantis-vartotojas/
        laisvos-galios-patitikrinimas/${{ github.event.inputs.ESO_ID }}
        ?objectCode=${{ github.event.inputs.ESO_ID }}

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Setup Python 3.11
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Check ESO URL reachable
        run: |
          echo "DEBUG ▶️ Pinging $URL"
          curl -Is "$URL" -m 20 | head -n1

      - name: Run Python monitor
        run: python monitor.py
